<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RavensOne WASM + Reactive Counter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .count-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
        }
        .count-value {
            color: white;
            font-size: 72px;
            font-weight: bold;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        button {
            flex: 1;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        button.reset {
            background: #f093fb;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            font-size: 13px;
            margin-top: 15px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .log {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî• RavensOne</h1>
        <p>Full-Stack Reactive Language ‚Ä¢ WASM + Signal-based Reactivity</p>
    </div>

    <div class="grid">
        <!-- JavaScript Reactive Counter -->
        <div class="card">
            <h2>üìä Pure Reactive Counter</h2>
            <div class="count-display">
                <div class="count-value" id="js-count">0</div>
            </div>
            <div class="controls">
                <button onclick="jsDecrement()">‚ûñ</button>
                <button onclick="jsIncrement()">‚ûï</button>
                <button class="reset" onclick="jsReset()">üîÑ</button>
            </div>
            <div id="js-status" class="status info">
                Pure JavaScript Signal/Effect system
            </div>
        </div>

        <!-- WASM Counter (simulated) -->
        <div class="card">
            <h2>‚ö° WASM Counter</h2>
            <div class="count-display">
                <div class="count-value" id="wasm-count">0</div>
            </div>
            <div class="controls">
                <button onclick="wasmDecrement()">‚ûñ</button>
                <button onclick="wasmIncrement()">‚ûï</button>
                <button class="reset" onclick="wasmReset()">üîÑ</button>
            </div>
            <div id="wasm-status" class="status">
                Loading WASM module...
            </div>
        </div>

        <!-- System Status -->
        <div class="card">
            <h2>üîç System Status</h2>
            <div id="system-info" class="status info">
                Initializing...
            </div>
            <div style="margin-top: 15px;">
                <strong>WASM Exports:</strong>
                <pre id="wasm-exports">Loading...</pre>
            </div>
        </div>

        <!-- Event Log -->
        <div class="card">
            <h2>üìù Event Log</h2>
            <div class="log" id="event-log"></div>
            <button onclick="clearLog()" style="margin-top: 10px; width: 100%;">Clear Log</button>
        </div>
    </div>

    <!-- Load reactive runtime -->
    <script src="dist/reactive-runtime.js"></script>

    <script>
        // Event logging
        const eventLog = [];
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${message}`);
            const logEl = document.getElementById('event-log');
            logEl.innerHTML = eventLog.slice(-20).reverse().map(msg => 
                `<div class="log-entry">${msg}</div>`
            ).join('');
            console.log(message);
        }

        function clearLog() {
            eventLog.length = 0;
            document.getElementById('event-log').innerHTML = '';
        }

        // JavaScript reactive counter
        let jsSignal = null;
        let jsUpdateCount = 0;

        function jsIncrement() {
            jsSignal.set(jsSignal.get() + 1);
            log(`JS: Increment ‚Üí ${jsSignal.get()}`);
        }

        function jsDecrement() {
            jsSignal.set(jsSignal.get() - 1);
            log(`JS: Decrement ‚Üí ${jsSignal.get()}`);
        }

        function jsReset() {
            jsSignal.set(0);
            log(`JS: Reset ‚Üí 0`);
        }

        // WASM counter
        let wasmSignal = null;
        let wasmInstance = null;

        function wasmIncrement() {
            wasmSignal.set(wasmSignal.get() + 1);
            log(`WASM: Increment ‚Üí ${wasmSignal.get()}`);
        }

        function wasmDecrement() {
            wasmSignal.set(wasmSignal.get() - 1);
            log(`WASM: Decrement ‚Üí ${wasmSignal.get()}`);
        }

        function wasmReset() {
            wasmSignal.set(0);
            log(`WASM: Reset ‚Üí 0`);
        }

        // Initialize
        async function init() {
            try {
                log('üöÄ Initializing RavensOne...');

                // Check reactive runtime
                if (!window.RavensReactive) {
                    throw new Error('Reactive runtime not loaded');
                }
                log('‚úÖ Reactive runtime loaded');

                // Initialize JS counter
                jsSignal = new window.RavensReactive.Signal(0);
                new window.RavensReactive.Effect(() => {
                    const value = jsSignal.get();
                    document.getElementById('js-count').textContent = value;
                    jsUpdateCount++;
                });
                log(`‚úÖ JS Signal created (ID: ${jsSignal.id})`);

                document.getElementById('js-status').className = 'status success';
                document.getElementById('js-status').textContent = 
                    `‚úÖ Ready! Updates: ${jsUpdateCount}`;

                // Initialize WASM counter
                wasmSignal = new window.RavensReactive.Signal(0);
                new window.RavensReactive.Effect(() => {
                    const value = wasmSignal.get();
                    document.getElementById('wasm-count').textContent = value;
                });
                log(`‚úÖ WASM Signal created (ID: ${wasmSignal.id})`);

                // Try to load WASM module
                try {
                    const response = await fetch('examples/counter-simple.wasm');
                    const wasmBytes = await response.arrayBuffer();

                    const importObject = {
                        env: {
                            signal_new: (val) => {
                                const sig = new window.RavensReactive.Signal(val);
                                log(`WASM created signal: ${sig.id}`);
                                return sig.id;
                            },
                            signal_get: (id) => {
                                log(`WASM: signal_get(${id})`);
                                return 0;
                            },
                            signal_set: (id, val) => {
                                log(`WASM: signal_set(${id}, ${val})`);
                            }
                        }
                    };

                    const module = await WebAssembly.instantiate(wasmBytes, importObject);
                    wasmInstance = module.instance;

                    const exports = Object.keys(wasmInstance.exports).join(', ');
                    document.getElementById('wasm-exports').textContent = exports || 'none';
                    
                    log(`‚úÖ WASM module loaded`);
                    log(`üì¶ Exports: ${exports}`);

                    document.getElementById('wasm-status').className = 'status success';
                    document.getElementById('wasm-status').textContent = '‚úÖ WASM loaded successfully!';

                } catch (err) {
                    log(`‚ö†Ô∏è  WASM load failed: ${err.message}`);
                    document.getElementById('wasm-status').className = 'status error';
                    document.getElementById('wasm-status').textContent = 
                        '‚ö†Ô∏è WASM not available (using JS simulation)';
                    document.getElementById('wasm-exports').textContent = 'N/A';
                }

                // Update system info
                document.getElementById('system-info').innerHTML = `
                    <strong>‚úÖ All Systems Operational</strong><br><br>
                    <strong>Reactive Runtime:</strong><br>
                    ‚Ä¢ Signal implementation: ‚úÖ<br>
                    ‚Ä¢ Effect tracking: ‚úÖ<br>
                    ‚Ä¢ Dependency graph: ‚úÖ<br>
                    <br>
                    <strong>Counters:</strong><br>
                    ‚Ä¢ JS Counter: Signal #${jsSignal.id}<br>
                    ‚Ä¢ WASM Counter: Signal #${wasmSignal.id}<br>
                    <br>
                    <strong>Performance:</strong><br>
                    ‚Ä¢ Fine-grained updates: ‚úÖ<br>
                    ‚Ä¢ O(1) signal access: ‚úÖ<br>
                    ‚Ä¢ Automatic re-renders: ‚úÖ
                `;

                log('üéâ Initialization complete!');

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                document.getElementById('system-info').className = 'status error';
                document.getElementById('system-info').textContent = '‚ùå ' + error.message;
            }
        }

        // Start!
        init();
    </script>
</body>
</html>
